{% load i18n %}
{% load custom_fields %}

{# This template is meant to be included in the registration form #}
{% if custom_fields %}
<div class="card mb-4">
  <div class="card-header">
    <h5 class="mb-0">{% trans "Additional Information" %}</h5>
  </div>
  <div class="card-body">
    {% for field in custom_fields %}
      <div class="mb-3">
        {% if field.field_type == 'text' %}
          <label for="custom_{{ field.id }}" class="form-label">
            {{ field.label }}{% if field.required %} <span class="text-danger">*</span>{% endif %}
          </label>
          <input 
            type="text" 
            class="form-control {% if form.errors.custom_fields and field.id in form.errors.custom_fields %}is-invalid{% endif %}" 
            id="custom_{{ field.id }}" 
            name="custom_fields[{{ field.id }}]" 
            placeholder="{{ field.placeholder }}"
            {% if field.required %}required{% endif %}
            {% if form.data.custom_fields and field.id in form.data.custom_fields %}value="{{ form.data.custom_fields|get_custom_field_value:field.id }}"{% endif %}
          >
        
        {% elif field.field_type == 'textarea' %}
          <label for="custom_{{ field.id }}" class="form-label">
            {{ field.label }}{% if field.required %} <span class="text-danger">*</span>{% endif %}
          </label>
          <textarea 
            class="form-control {% if form.errors.custom_fields and field.id in form.errors.custom_fields %}is-invalid{% endif %}" 
            id="custom_{{ field.id }}" 
            name="custom_fields[{{ field.id }}]" 
            placeholder="{{ field.placeholder }}"
            rows="3"
            {% if field.required %}required{% endif %}
          >{% if form.data.custom_fields and field.id in form.data.custom_fields %}{{ form.data.custom_fields|get_custom_field_value:field.id }}{% endif %}</textarea>
        
        {% elif field.field_type == 'number' %}
          <label for="custom_{{ field.id }}" class="form-label">
            {{ field.label }}{% if field.required %} <span class="text-danger">*</span>{% endif %}
          </label>
          <input 
            type="number" 
            class="form-control {% if form.errors.custom_fields and field.id in form.errors.custom_fields %}is-invalid{% endif %}" 
            id="custom_{{ field.id }}" 
            name="custom_fields[{{ field.id }}]" 
            {% if field.required %}required{% endif %}
            {% if form.data.custom_fields and field.id in form.data.custom_fields %}value="{{ form.data.custom_fields|get_custom_field_value:field.id }}"{% endif %}
          >
        
        {% elif field.field_type == 'email' %}
          <label for="custom_{{ field.id }}" class="form-label">
            {{ field.label }}{% if field.required %} <span class="text-danger">*</span>{% endif %}
          </label>
          <input 
            type="email" 
            class="form-control {% if form.errors.custom_fields and field.id in form.errors.custom_fields %}is-invalid{% endif %}" 
            id="custom_{{ field.id }}" 
            name="custom_fields[{{ field.id }}]" 
            placeholder="{{ field.placeholder }}"
            {% if field.required %}required{% endif %}
            {% if form.data.custom_fields and field.id in form.data.custom_fields %}value="{{ form.data.custom_fields|get_custom_field_value:field.id }}"{% endif %}
          >
        
        {% elif field.field_type == 'url' %}
          <label for="custom_{{ field.id }}" class="form-label">
            {{ field.label }}{% if field.required %} <span class="text-danger">*</span>{% endif %}
          </label>
          <input 
            type="url" 
            class="form-control {% if form.errors.custom_fields and field.id in form.errors.custom_fields %}is-invalid{% endif %}" 
            id="custom_{{ field.id }}" 
            name="custom_fields[{{ field.id }}]" 
            placeholder="{{ field.placeholder }}"
            {% if field.required %}required{% endif %}
            {% if form.data.custom_fields and field.id in form.data.custom_fields %}value="{{ form.data.custom_fields|get_custom_field_value:field.id }}"{% endif %}
          >
        
        {% elif field.field_type == 'date' %}
          <label for="custom_{{ field.id }}" class="form-label">
            {{ field.label }}{% if field.required %} <span class="text-danger">*</span>{% endif %}
          </label>
          <input 
            type="date" 
            class="form-control {% if form.errors.custom_fields and field.id in form.errors.custom_fields %}is-invalid{% endif %}" 
            id="custom_{{ field.id }}" 
            name="custom_fields[{{ field.id }}]" 
            {% if field.required %}required{% endif %}
            {% if form.data.custom_fields and field.id in form.data.custom_fields %}value="{{ form.data.custom_fields|get_custom_field_value:field.id }}"{% endif %}
          >
        
        {% elif field.field_type == 'select' %}
          <label for="custom_{{ field.id }}" class="form-label">
            {{ field.label }}{% if field.required %} <span class="text-danger">*</span>{% endif %}
          </label>
          <select 
            class="form-select {% if form.errors.custom_fields and field.id in form.errors.custom_fields %}is-invalid{% endif %}" 
            id="custom_{{ field.id }}" 
            name="custom_fields[{{ field.id }}]"
            {% if field.required %}required{% endif %}
          >
            <option value="">-- {% trans "Select" %} --</option>
            {% for option in field.get_options_list %}
              <option value="{{ option }}" {% if form.data.custom_fields and field.id in form.data.custom_fields and form.data.custom_fields|get_custom_field_value:field.id == option %}selected{% endif %}>{{ option }}</option>
            {% endfor %}
          </select>
        
        {% elif field.field_type == 'radio' %}
          <fieldset>
            <legend class="form-label">
              {{ field.label }}{% if field.required %} <span class="text-danger">*</span>{% endif %}
            </legend>
            {% for option in field.get_options_list %}
              <div class="form-check">
                <input 
                  type="radio" 
                  class="form-check-input {% if form.errors.custom_fields and field.id in form.errors.custom_fields %}is-invalid{% endif %}" 
                  id="custom_{{ field.id }}_{{ forloop.counter }}" 
                  name="custom_fields[{{ field.id }}]" 
                  value="{{ option }}"
                  {% if field.required %}required{% endif %}
                  {% if form.data.custom_fields and field.id in form.data.custom_fields and form.data.custom_fields|get_custom_field_value:field.id == option %}checked{% endif %}
                >
                <label class="form-check-label" for="custom_{{ field.id }}_{{ forloop.counter }}">
                  {{ option }}
                </label>
              </div>
            {% endfor %}
          </fieldset>
        
        {% elif field.field_type == 'checkbox' %}
          <fieldset>
            <legend class="form-label">
              {{ field.label }}{% if field.required %} <span class="text-danger">*</span>{% endif %}
            </legend>
            {% for option in field.get_options_list %}
              <div class="form-check">
                <input 
                  type="checkbox" 
                  class="form-check-input {% if form.errors.custom_fields and field.id in form.errors.custom_fields %}is-invalid{% endif %}" 
                  id="custom_{{ field.id }}_{{ forloop.counter }}" 
                  name="custom_fields[{{ field.id }}][]" 
                  value="{{ option }}"
                  {% if field.required %}required{% endif %}
                  {% if form.data.custom_fields and field.id in form.data.custom_fields and option in form.data.custom_fields|get_custom_field_values:field.id %}checked{% endif %}
                >
                <label class="form-check-label" for="custom_{{ field.id }}_{{ forloop.counter }}">
                  {{ option }}
                </label>
              </div>
            {% endfor %}
          </fieldset>
        
        {% elif field.field_type == 'boolean' %}
          <div class="form-check">
            <input 
              type="checkbox" 
              class="form-check-input {% if form.errors.custom_fields and field.id in form.errors.custom_fields %}is-invalid{% endif %}" 
              id="custom_{{ field.id }}" 
              name="custom_fields[{{ field.id }}]" 
              value="1"
              {% if field.required %}required{% endif %}
              {% if form.data.custom_fields and field.id in form.data.custom_fields and form.data.custom_fields|get_custom_field_value:field.id %}checked{% endif %}
            >
            <label class="form-check-label" for="custom_{{ field.id }}">
              {{ field.label }}{% if field.required %} <span class="text-danger">*</span>{% endif %}
            </label>
          </div>
        {% endif %}
        
        {% if field.description %}
          <div class="form-text">{{ field.description }}</div>
        {% endif %}
        
        {% if form.errors.custom_fields and field.id in form.errors.custom_fields %}
          <div class="invalid-feedback d-block">
            {{ form.errors.custom_fields|get_custom_field_error:field.id }}
          </div>
        {% endif %}
      </div>
    {% endfor %}
  </div>
</div>
{% endif %}
