{% extends "superadmin/base.html" %}

{% block dashboard_title %}Edit User{% endblock %}

{% block dashboard_content %}
<div class="dashboard-card">
  <div class="card-header">
    <h3>Edit User: {{ user.username }}</h3>
  </div>
  <div class="card-body">
    <form method="post" class="needs-validation" novalidate>
      {% csrf_token %}
      
      <div class="row mb-3">
        <div class="col-md-6">
          <label for="username" class="form-label">Username</label>
          <input type="text" class="form-control" id="username" name="username" value="{{ user.username }}" required>
          <div class="invalid-feedback">
            Please provide a username.
          </div>
        </div>
        <div class="col-md-6">
          <label for="email" class="form-label">Email</label>
          <input type="email" class="form-control" id="email" name="email" value="{{ user.email }}" required>
          <div class="invalid-feedback">
            Please provide a valid email.
          </div>
        </div>
      </div>
      
      <div class="row mb-3">
        <div class="col-md-6">
          <label for="first_name" class="form-label">First Name</label>
          <input type="text" class="form-control" id="first_name" name="first_name" value="{{ user.first_name }}" required>
          <div class="invalid-feedback">
            Please provide a first name.
          </div>
        </div>
        <div class="col-md-6">
          <label for="last_name" class="form-label">Last Name</label>
          <input type="text" class="form-control" id="last_name" name="last_name" value="{{ user.last_name }}" required>
          <div class="invalid-feedback">
            Please provide a last name.
          </div>
        </div>
      </div>
      
      <div class="row mb-3">
        <div class="col-md-6">
          <label for="new_password" class="form-label">New Password (leave blank to keep current)</label>
          <input type="password" class="form-control" id="new_password" name="new_password">
        </div>
        <div class="col-md-6">
          <label for="confirm_new_password" class="form-label">Confirm New Password</label>
          <input type="password" class="form-control" id="confirm_new_password" name="confirm_new_password">
        </div>
      </div>
      
      <div class="row mb-3">
        <div class="col-md-6">
          <label for="type" class="form-label">User Type</label>
          <select class="form-select" id="type" name="type" required>
            <option value="user" {% if user.type == 'user' %}selected{% endif %}>Regular User</option>
            <option value="organizer" {% if user.type == 'organizer' %}selected{% endif %}>Organizer</option>
            <option value="admin" {% if user.type == 'admin' %}selected{% endif %}>Admin</option>
          </select>
          <div class="invalid-feedback">
            Please select a user type.
          </div>
        </div>
        <div class="col-md-6">
          <label for="phone" class="form-label">Phone Number</label>
          <input type="tel" class="form-control" id="phone" name="phone" value="{{ user.phone }}" required>
          <div class="invalid-feedback">
            Please provide a valid phone number.
          </div>
        </div>
      </div>
      
      <div class="form-check mb-3">
        <input class="form-check-input" type="checkbox" value="1" id="is_active" name="is_active" {% if user.is_active %}checked{% endif %}>
        <label class="form-check-label" for="is_active">
          Active Account
        </label>
      </div>
      
      <div class="form-check mb-3">
        <input class="form-check-input" type="checkbox" value="1" id="email_verified" name="email_verified" {% if user.email_verified %}checked{% endif %}>
        <label class="form-check-label" for="email_verified">
          Email Verified
        </label>
      </div>
      
      <div class="form-check mb-3">
        <input class="form-check-input" type="checkbox" value="1" id="banned" name="banned" {% if user.banned %}checked{% endif %}>
        <label class="form-check-label" for="banned">
          Banned User
        </label>
      </div>
      
      <div class="mt-4">
        <button type="submit" class="btn btn-primary">Update User</button>
        <a href="{% url 'superadmin:users' %}" class="btn btn-secondary">Cancel</a>
      </div>
    </form>
  </div>
</div>

<div class="dashboard-card mt-4">
  <div class="card-header">
    <h3>User Information</h3>
  </div>
  <div class="card-body">
    <div class="row">
      <div class="col-md-6">
        <h4>Account Details</h4>
        <ul class="list-group mb-4">
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <span>User ID:</span>
            <span>{{ user.id }}</span>
          </li>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <span>Date Joined:</span>
            <span>{{ user.date_joined|date:"M d, Y H:i" }}</span>
          </li>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <span>Last Active:</span>
            <span>{{ user.last_active|date:"M d, Y H:i" }}</span>
          </li>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <span>Last Password Change:</span>
            <span>{{ user.last_password_change|date:"M d, Y H:i"|default:"Never" }}</span>
          </li>
        </ul>
      </div>
      
      <div class="col-md-6">
        <h4>Team Information</h4>
        <ul class="list-group mb-4">
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <span>Team:</span>
            <span>{{ user.team.name|default:"Not in a team" }}</span>
          </li>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <span>Team Captain:</span>
            <span>{% if user.is_team_captain %}Yes{% else %}No{% endif %}</span>
          </li>
        </ul>
      </div>
    </div>
    
    <div class="row">
      <div class="col-md-12">
        <h4>Activity</h4>
        <ul class="list-group">
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <span>Score:</span>
            <span>{{ user.score }}</span>
          </li>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <span>Challenges Solved:</span>
            <span>{{ user.get_solved_challenges|length }}</span>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
{% endblock %}
